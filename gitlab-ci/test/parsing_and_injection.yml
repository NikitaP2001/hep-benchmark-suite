bats_test_docker_compose_qa:
  stage: test-parsing-and-injection
  needs:
    - job: build_docker_compose_image
      optional: true
  image:
    name: gitlab-registry.cern.ch/hep-benchmarks/hep-benchmark-suite/docker-compose:latest
    entrypoint: [""]
  tags:
    - hep-benchmarks
    - x86_64
  script:
    - . $CI_PROJECT_DIR/tests/docker_compose_amq_to_es/ci_run_script.sh
    - ci_run_script
  after_script:
    - . $CI_PROJECT_DIR/tests/docker_compose_amq_to_es/ci_run_script.sh
    - stop_docker_compose
  artifacts:
    paths:
        - $CI_PROJECT_DIR/tests/docker_compose_amq_to_es/*
    expire_in: 1 week
    when: always
  rules:
    - if: $CI_COMMIT_BRANCH =~ /^qa.*$/ 
    - if: $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME =~ /^qa.*$/ 
    - if: $CI_MERGE_REQUEST_TARGET_BRANCH_NAME =~ /^qa.*$/
