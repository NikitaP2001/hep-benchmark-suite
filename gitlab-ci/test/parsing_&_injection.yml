bats_test_docker_compose_qa:
  stage: test-parsing-and-injection
  image:
    name: gitlab-registry.cern.ch/cloud-infrastructure/data-analytics/compose:v0.1
    entrypoint: [""]
  tags:
    - hep-benchmarks
    - x86_64
  rules:
    - if: $CI_COMMIT_BRANCH =~ /^qa.*$/ || $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME =~ /^qa.*$/
  script:
    - . $CI_PROJECT_DIR/tests/docker_compose_amq_to_es/ci_run_script.sh
    - ci_run_script
  after_script:
    - . $CI_PROJECT_DIR/tests/docker_compose_amq_to_es/ci_run_script.sh
    - stop_docker_compose
  artifacts:
    paths:
        - $CI_PROJECT_DIR/tests/docker_compose_amq_to_es/*
    expire_in: 1 week
    when: always
